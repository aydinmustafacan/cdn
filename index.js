var u=class{static replacePunctuations(e){return e.replace(/[^\w\s]/gi,"")}},L=u;var y=class{constructor(e){let t=L.replacePunctuations(e);this.body=t}},v=y;var b=class{stemWord(e){let t=e.toLowerCase();return t.length<3||(t=this.stemStep1a(t),t=this.stemStep1b(t),t=this.stemStep1c(t),t=this.stemStep2(t),t=this.stemStep3(t),t=this.stemStep4(t),t=this.stemStep5a(t),t=this.stemStep5b(t)),t}stemStep1a(e){return e.endsWith("sses")||e.endsWith("ies")?e.substring(0,e.length-2):e.endsWith("ss")?e:e.endsWith("s")?e.substring(0,e.length-1):e}stemStep1b(e){if(e.endsWith("eed")){let t=e.substring(0,e.length-1);return this.getM(this.getLetterTypes(t))>0?t:e}if(e.endsWith("ed")){let t=e.substring(0,e.length-2);return this.getLetterTypes(t).includes("v")?this.step1b2(t):e}if(e.endsWith("ing")){let t=e.substring(0,e.length-3);return this.getLetterTypes(t).includes("v")?this.step1b2(t):e}return e}step1b2(e){if(e.endsWith("at")||e.endsWith("bl")||e.endsWith("iz"))return e+"e";let t=e.charAt(e.length-1);return e[e.length-2]===t&&!["l","s","z"].includes(t)?e.substring(0,e.length-1):this.getM(this.getLetterTypes(e))===1&&this.isStarO(e)?e+"e":e}stemStep1c(e){if(e.endsWith("y")){let t=e.substring(0,e.length-1);if(this.getLetterTypes(t).includes("v"))return t+"i"}return e}stemStep2(e){let t={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"};for(let[s,r]of Object.entries(t))if(e.endsWith(s)){let i=e.substring(0,e.length-s.length);if(this.getM(this.getLetterTypes(i))>0)return i+r}return e}stemStep3(e){let t={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""};for(let[s,r]of Object.entries(t))if(e.endsWith(s)){let i=e.substring(0,e.length-s.length);if(this.getM(this.getLetterTypes(i))>0)return i+r}return e}stemStep4(e){let t=["al","ance","ence","er","ic","able","ible","ant","ement","ment","ent","ion","ou","ism","ate","iti","ous","ive","ize"];for(let s of t)if(e.endsWith(s)){let r=e.substring(0,e.length-s.length);if(this.getM(this.getLetterTypes(r))>1){if(s==="ion"&&["s","t"].includes(r.charAt(r.length-1)))return r;if(s!=="ion")return r}}return e}stemStep5a(e){if(e.endsWith("e")){let t=e.substring(0,e.length-1),s=this.getM(this.getLetterTypes(t));if(s>1||s===1&&!this.isStarO(t))return t}return e}stemStep5b(e){return e.endsWith("ll")&&this.getM(this.getLetterTypes(e))>1?e.substring(0,e.length-1):e}getLetterTypes(e){let t=[];for(let s=0;s<e.length;s++){let r=t[t.length-1],i=this.getLetterType(e[s],r);i!==r&&t.push(i)}return t.join("")}getLetterType(e,t){return"aeiou".includes(e)?"v":"c"}getM(e){let t=/vc/.exec(e);return t?t.length:0}isStarO(e){let t=e.length;return t>=3&&/[aeiou]/.test(e[t-3])&&!/[aeiou]/.test(e[t-2])&&!/[aeiouwxy]/.test(e[t-1])}},k=b;var p=class{mostCommonWordsInEnglish=new Set(["the","i","a","be","to","of","and","in","that","have"]);constructor(e){if(!e||typeof e.body!="string")throw new Error("Invalid query data");let t=e.body.toLowerCase().replace(/[^\w\s]|_/g,"").replace(/\s+/g," ").trim().split(" ");this.tokens=t.filter(r=>!this.mostCommonWordsInEnglish.has(r));let s=new k;for(let r=0;r<this.tokens.length;r++)this.tokens[r]=s.stemWord(this.tokens[r]);this.tokenNumber=this.tokens.length,console.log(this.tokens),console.log("There exist "+this.tokenNumber+" tokens in the query.")}},W=p;var m=class{static positionalIntersect(e,t,s){let r=new Set,i={},o=Object.keys(e).map(n=>Number(n)),f=Object.keys(t).map(n=>Number(n));for(let n of o)if(f.includes(n)){let g=e[n],c=t[n],d=[],a=0,l=0;for(;a<g.length&&l<c.length;)c[l]-g[a]>=0&&c[l]-g[a]<=s?(d.push(c[l]),l++):g[a]<c[l]?a++:l++;d.length>0&&(r.add(n),i[n]=d)}return{matchedDocIds:r,intersectionPositions:i}}};var x=class{constructor(e,t,s){this.tokens=e.tokens,this.invertedIndex=t,this.dictionary=s}applyProximityQuery(){let e=this._extractListOfPostingsLists(),t=e[0];if(e.length===1)return Object.keys(t).map(r=>Number(r));let s=new Set;for(let r=1;r<e.length;r++){let i=e[r],{matchedDocIds:o,intersectionPositions:f}=m.positionalIntersect(t,i,1);if(console.log("matchedDocIds"),console.log(o),console.log("intersectionPositions"),console.log(f),t=f,s=o,o.size===0)break}return Array.from(s)}_extractListOfPostingsLists(){let e=[];for(let t of this.tokens){let s=this.invertedIndex[this.dictionary[t]];s&&e.push(s)}return e}},I=x;var S=class{constructor(e,t,s){this.queryString=e,this.invertedIndex=t,this.dictionary=s}run(){console.log("QueryRunner.run()");let e=new v(this.queryString),t=new W(e);return new I(t,this.invertedIndex,this.dictionary).applyProximityQuery()}},D=S;export{D as default};
//# sourceMappingURL=index.js.map
